<!DOCTYPE html>
<html>
    <head>
      <title>Draw as much as you can!</title>
      <meta name="viewport" content="width=device-width,initial-scale=1.0">
      <!-- <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script> -->

      <!-- adding in socket.io so that we can have multiple players -->
      <script src="/socket.io/socket.io.js"></script>
      <style>
        #countdown {
          font-size: 20px;
          font-weight: bold;
        }

        .outsideButton {
          display: flex; 
          justify-content: center; 
          align-items: center; 
          height: 100%; 
        }

        #startGameButton {
          position: relative;
          width: 300px;
          height: 50px;
          font-size: 40px;
          align-items: center;
        }
      </style>


    </head>
    <body>
      <!-- <div id="aframe-stuff" style="width: 100%; height: 400px;"> -->
        <!-- <a-scene>
           * fixed camera position * -->
          <!-- <a-camera position="0 0 5" rotation="0 0 0"></a-camera> -->
          <!-- <a-camera>
            <a-cursor></a-cursor>
          </a-camera> -->
  
          <!-- the start game button -->
          <!-- <a-plane id="startGameButton" position="0 1 -3" rotation="0 0 0" width="1" height="0.5" color="#4CC3D9"></a-plane> -->
          <!-- <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9" id="start-button">
            <a-text value="Button" position="0 0 0.55"></a-text>  align="center" 
          </a-box> 
        
        </a-scene> -->
      <!-- </div> -->

    <canvas id="drawingCanvas" width="800" height="600" style="border:1px solid black;"></canvas>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        //colour:
        ctx.strokeStyle = 'red';

        const socket = io('http://localhost:1111');

        

        // Emit drawing data to the server
        function emitDraw(x, y, type) {
          console.log("emitting the drawing");
          socket.emit('draw', { x, y, type });
        }

        // Draw line based on data from server

        // socket.on('draw', (data) => {
        //   console.log("Received draw event on client", data);
        //   // Respond to the server as a test
        //   socket.emit('testResponse', { msg: "Client received draw event." });
        //   socket.broadcast.emit('draw', data);
        // });
        socket.on('draw', (data) => {
          console.log("drawing to the server");
          const { x, y, type } = data;
          if (type === 'start') {
            ctx.beginPath();
            ctx.moveTo(x, y);
          } else if (type === 'continue') {
            ctx.lineTo(x, y);
            ctx.stroke();
          }
        });

        canvas.addEventListener('mousedown', (e) => {
          console.log("should be drawing");
          drawing = true;
          // Start drawing on the client's canvas
          ctx.beginPath();
          ctx.moveTo(e.offsetX, e.offsetY);
          // Emit drawing start action
          emitDraw(e.offsetX, e.offsetY, 'start');
        });

        canvas.addEventListener('mousemove', (e) => {
          if (!drawing) return;
          // Continue drawing on the client's canvas
          ctx.lineTo(e.offsetX, e.offsetY);
          ctx.stroke();
          // Emit drawing continue action
          emitDraw(e.offsetX, e.offsetY, 'continue');
        });

        canvas.addEventListener('mouseup', () => {
          drawing = false;
        });

        canvas.addEventListener('mouseout', () => {
          drawing = false;
        });
      });
    </script>
      
      
      <!-- <script>
        //start game button javascript
        // document.querySelector('#button').addEventListener('click', function () {
        //   // <button onclick="startingCountdown(countdownAmount, displayed)">Start Game!</button>
        //   startingCountdown(countdownAmount, displayed);
        // });
      </script> -->
      <!-- <ul id="messages"></ul>
    <form id="form" action="">
      <input id="input" autocomplete="off" /><button>Send</button>
    </form> -->
      
    <button onclick="pickPlayer1()" position="0 0 0">Player 1</button>
    <button onclick="pickPlayer2()" position="5 5 5">Player 2</button>

    <!-- <script>
      function pickPlayer1() {
        const player1 = document.getElementById('player1').value;
        pickPlayer1(player1);
      }

      function pickPlayer2() {
        const player2 = document.getElementById('player2').value;
        pickPlayer2(player2);
      }
    </script> -->

    <script>
      const socket = io('http://localhost:1111');

      //function for joining player 1
      function pickPlayer1(player1) {
        socket.emit('pickPlayer1', player1);
      }

      //function for joining player 2
      function pickPlayer2(player2) {
        socket.emit('pickPlayer2', player2);
      }
      
    </script>

    <div id="countdown" class="outsideButton"></div>
    <script>
      // Timer stuff
      function startingCountdown() {
        console.log("we are in the countdown");
        const countdownAmount = 60 * 1; //1 minute
        const displayed = document.querySelector('#countdown');
        let timer = countdownAmount, minutes, seconds;

        const interval = setInterval(function () {
          minutes = parseInt(timer / 60, 10);
          seconds = parseInt(timer % 60, 10);

          minutes = minutes < 10 ? "0" + minutes : minutes;
          seconds = seconds < 10 ? "0" + seconds : seconds;

          displayed.textContent = minutes + ":" + seconds;

          if (--timer < 0) {
            clearInterval(interval);

            //STOP THE GAME AND GIVE THE PERCENTAGE OF THE SCREEN COVERED
          }
        }, 1000);
      }

    </script>
    <div class="outsideButton">
      <button id="startGameButton" onclick="startingCountdown()">Start Game!</button>
    </div>
    
    </body>
</html>